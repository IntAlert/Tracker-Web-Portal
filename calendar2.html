<!DOCTYPE html>
<html>
<head>
<!--Initializing Stuff-->
<meta charset='utf-8' />
<link rel='stylesheet' href='../lib/cupertino/jquery-ui.min.css' />
<link href='../fullcalendar.css' rel='stylesheet' />
<link href='../fullcalendar.print.css' rel='stylesheet' media='print' />
<script src='../lib/moment.min.js'></script>
<script src='../lib/jquery.min.js'></script>
<script src='../fullcalendar.min.js'></script>
    
<script src="https://cdn.firebase.com/js/client/2.0.4/firebase.js"></script>
<!--<script>var myFirebaseRef = new Firebase("https://crackling-fire-1447.firebaseio.com/");</script>-->
<script>var ref = new Firebase("https://crackling-fire-1447.firebaseio.com/trips");</script>
<!--<script>var calendar_url = new Firebase("https://crackling-fire-1447.firebaseio.com/");</script>-->
    
<script src='../lib/dateFormat.js'></script>

<!--------------------------------------Line-Break--------------------------------------------------------------------------------------->
    
      
<script>
ref.on('child_added', function(snapshot){
    var newTrip = snapshot.val();
    if (newTrip == 'Do not delete'){
        return;
    }
    console.log('got data')
    console.log(newTrip)

//--------------------------------------Line-Break---------------------------------------------------------------------------------------
    
    
//This sets up an empty array that will be filled with the data pulled from Firebase    
var count = 0;
var triggered = false;
var trip = [];
var myText = "";

//This collect the individual values from Firebase       
trip[count] = new Array();
trip[count][1] = newTrip.destination;
trip[count][2] = newTrip.leave;
trip[count][3] = newTrip.back;
trip[count][4] = snapshot.key();
trip[count][5] = newTrip.contact;
trip[count][6] = newTrip.name +" " + newTrip.lastname;
     console.log(trip[count][2])
     
//This creates a dynamic HTML form. Firebase doesn't like it when you try to call values from inside the body of the HTML (we don't know why)
myText += "<form value='displayTrip("+count+")' id='trips'><b>Name: </b>" + trip[count][6] + "<br><b>Destination: </b>" + trip[count][1] + "<br><b>Contact: </b>" + trip[count][5] + "<br><b>Departing: </b>" + trip[count][2] + "<br><b>Returning: </b>" + trip[count][3] + "</button>";

//    This block of code re-formats the date into a format that the calendar understands, i.e. the American format (...ugh)
    var newEvent = new Object();
    console.log('adding calendar')
    console.log(trip[count][6])
    newEvent.title = trip[count][6];
    newEvent.start = parseDMY(trip[count][2]).toYMD();
    newEvent.end = parseDMY(trip[count][3]).toYMD();
    newEvent.allDay = true;
    
    console.log(trip[count][2]);
    console.log(parseDMY(trip[count][2]));
    $('#calendar').fullCalendar( 'renderEvent', newEvent, true );
    console.log(parseDMY(trip[count][2]).toYMD());
    
    count = count + 1;
    
if(count>5 && triggered == false) {
    triggered = true;
    myText = '<form name="back" action="main.html"></form><br>' + myText;
    
}
    console.log(myText);
document.getElementById("trip").innerHTML = myText;    
});

        </script>
    
    
    
<script>

	function reload_calendar(){
    $(document).ready(function() {
//this initializes the calendar
		
        $('#calendar').fullCalendar({
			theme: true,
			header: {
				left: 'prev,next today',
				center: 'title',
				right: 'month,agendaWeek,agendaDay'
			},
			defaultDate: '2015-07-12',
//            selectable: true,
//            selectHelper: true,
			editable: true,
			eventLimit: true, // allow "more" link when too many events

		});
		
	})
            }
      reload_calendar();
		
</script>
    
<!--------------------------------------Line-Break--------------------------------------------------------------------------------------->
<!--
I'm bored so here's a Dalek:
                   ____
                 /  @   \==]|[=(]       E X T E R M I N A T E ! !
                |--------|
                ==========       .  *                                     *
                ==========     .\ * . *.   *                         .    * \  .
               ||||||||||||      \ * ./  *    .   *                      .  \ \
              |||||||||| --]%%%%%% .- =--=---=-=-=-=--=-=--=-==-----=-=-=-=-=-=
              [=========\  ]===========(  *                             . /  /
             [==============|   / *  \    .                          *  *   /  .
             C| @ @ @ @ @ @ D         *      *                        *
              |              \           .                          *  *
            C| @  @ @  @ @ @  D       .
             |                 \          *                          *
           C| @  @  @  @  @  @  D
            |                    \ 
          C| @  @  @   @   @   @  D
           |                       \
          |@@@@@@@@@@@@@@@@@@@@@@@@@|
           -------------------------  
-->
<!--------------------------------------Line-Break--------------------------------------------------------------------------------------->
<style>

	body {
		margin: 40px 10px;
		padding: 0;
		font-family: "Lucida Grande",Helvetica,Arial,Verdana,sans-serif;
		font-size: 14px;
	}

	#calendar {
		max-width: 900px;
		margin: 0 auto;
	}

</style>
    <script>
//        This allows the add trip button to create a new event
            function newEvent() {
            var newTrip = new Object();
//                console.log('Im Here!')

            newTrip.title = "some text";
            newTrip.start = '2015-02-22';
            newTrip.allDay = false;
            $('#calendar').fullCalendar( 'renderEvent', newTrip );
                console.log(newTrip);
            };
        

        </script>

</head>
    
<!--------------------------------------Line-Break--------------------------------------------------------------------------------------->
    
<body>
<!--    add trip button-->
<input class="btn btn-default btn-block" value="Add Trip" type="submit" id="button" onClick='newEvent()'/>
    <select>
        <option value="holiday">Holiday</option>
        <option value="maternity">Maternity Leave</option>
        <option value="meeting">Meeting</option>
        <option value="trip">Trip</option>
        <option value="working_from_home">Working From Home</option>
    </select>
	<div id='calendar'></div>


</body>
</html>
